$(function(){$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/',success:function(data){$(data).find("a:contains(.txt)").each(function(){var filename=this.href.replace(window.location.host,"").replace("https:///","");var nomPerso=filename.split(/[\/+.]/g);$("#charList").append("<li><a href=#>"+nomPerso[2]+"</a></li>")})}});var itsAChild=[];$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/Childrens',success:function(data){$(data).find("a:contains(.txt)").each(function(){var filename=this.href.replace(window.location.host,"").replace("http:///","");var nomPerso=filename.split(/[\/+.]/g);$("#charList").append("<li><a href=#>"+nomPerso[2]+"</a></li>");itsAChild.push(nomPerso[2])})}});$("#searchchar").on("click",function(){$('#searchchar').val('');$("#charList li").show()});$("#searchchar").on("keyup",function(){var saisieUser=$(this).val().toLowerCase();$("#charList li a").each(function(index){if($(this).text().toLowerCase().indexOf(saisieUser)===-1){$(this).parent().hide()}
else{$(this).parent().show()}})});$('#charList').on("click","a",function(){$("#HeroBuild table tr td").empty();$("#HeroBuild table tr").find("tr").replaceWith('<td></td>');$("#HeroBuild table tr").removeClass().addClass("drop");dropTalents();var persoChoisi=$(this).text();$('#searchchar').val(persoChoisi);$(".HeroBuildCard").css("display","flex");$("#HeroImgBuilder").attr('src','http://alexandreblin.ovh/FireEmblemStrategicApp/static/img/character_portrait/'+persoChoisi+'_portrait.png');$(".NomHerosBuilder").html(persoChoisi);$("#TalentsList table").remove();$("#TalentsList").hide();$("#myParent").remove();$('.chooseAParent').hide();$('.chooseAParent p').remove();if(jQuery.inArray(persoChoisi,itsAChild)!==-1){var nameChild=persoChoisi;$('.formulaireRecherche').append("<select id='myParent' class='myParentclass'><option value='default' selected>Choisir parent</option></select>");$('.chooseAParent').show();$('.chooseAParent').append("<p class='messageChooseParent'>Veuillez choisir un parent dans la liste qui se trouve sous la liste des personnages pour continuer</p>");fillParentList(nameChild)}else{$.get('http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/'+persoChoisi+'.txt',function(data){var dataduHerosSplit=data.split('/');var listeClassesBrut=dataduHerosSplit[1];var listeClasses=listeClassesBrut.split('-');TraitementData(listeClasses)},'text')}
$('.buildsave').remove();$('.OptionsMenu input').remove();$('.OptionsMenu').append('<input type="text" name="filenamebyuser" class="namefilebuildsave" placeholder="nom du build">');$('.namefilebuildsave').on("keyup",function(){var UserTyping=$(this).val();var reg=/([/\\:*?"<>|])/g;var isASpecialCharacter=reg.test(UserTyping);if(isASpecialCharacter){$(this).val(UserTyping.replace(reg,''))}});$('.OptionsMenu').append('<button class="buildsave">Sauvegarder mon build</button>');saveMyBuild()});function TraitementData(listeClasses){$(".goback").hide();$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/pages/class_talents_list.html',type:'GET',success:function(res){var tableau=res
$('#TalentsList').append(tableau);$('#TalentsList').show();$('#TalentsList').append("<table class='tableskill2 drag'><tbody></tbody></table>");$('#TalentsList').append("<table class='tableskill1 drag'><tbody></tbody></table>");$(".TalentsListclass").css("border","2px solid rgb(110, 108, 93)");$(".TalentsListclass").css("overflow-y","scroll");$('#TalentsList table tr').each(function(){var tdskill2=$(this).children('td').eq(3);var tdskill2desc=$(this).children('td').eq(4);$("<tr class='"+$(this).attr('class')+"'><td>"+tdskill2.html()+"</td><td>"+tdskill2desc.html()+"</td></tr>").appendTo(".tableskill2 tbody");tdskill2.remove();tdskill2desc.remove();var tdskill1=$(this).children('td').eq(1);var tdskill1desc=$(this).children('td').eq(2);$("<tr class='"+$(this).attr('class')+"'><td>"+tdskill1.html()+"</td><td>"+tdskill1desc.html()+"</td></tr>").appendTo(".tableskill1 tbody");tdskill1.remove();tdskill1desc.remove()});$("#TalentsList table tr").hide();var classe;for(var i=0;i<listeClasses.length;i++){classe=listeClasses[i].split(" ").join("");if($("tableau:contains('."+classe+"')")){$("#TalentsList ."+classe).show();$("#TalentsList ."+classe).addClass("drag");$("#TalentsList ."+classe).draggable({containment:'.wrapper',helper:"clone",start:function(){var row_index1=$(this).parent().index();var col_index1=$(this).index();$(this).animate({opacity:'0.5'},1000)},stop:function(){$(this).animate({opacity:'1'},1000)}})}}
$("#TalentsList table").first().remove()}})}
function dropTalents(){$('.drop').droppable({accept:'.drag',drop:function(event,ui){var droppable=$(this);var draggable=ui.draggable;var droppablechild=$(droppable).children();if($(droppablechild[0]).is('td')){var row_index=$(draggable).parent().index();var col_index=$(draggable).index();var tableOrigin=$(draggable).closest('table').attr('class').split(' ')[0];$(droppable).find('td').remove()
draggable.appendTo(droppable);$(draggable).draggable('disable');$(draggable).removeClass("drag");$(draggable).append("<button class='goback'>X</button>");$(".goback").show();$(".goback").on("click",function(){var trVoyager=$(this).parent();var trDropOriginelle=$(this).parent().parent();$(this).remove();$("."+tableOrigin+" tbody").after(trVoyager[0]);$(trVoyager[0]).draggable('enable');$(draggable).addClass("drag");$(trDropOriginelle).append('<td></td>')})}}})}
function saveMyBuild(){$('.buildsave').on("click",function(){var alltr=$(".TalentsChoosenBuilder tbody tr");var chosenOnes=alltr.filter(':not(.drop)');var encoderforAJAX=[];var date=new Date();date.setTime(date.getTime()+(30*1000));var expires="; expires="+date.toGMTString();encoderforAJAX.push($('.NomHerosBuilder').text());if($(".namefilebuildsave").val()==""){var Zawarudo=new Date($.now());var defaultfilename=Zawarudo.getDate()+"/"+Zawarudo.getMonth()+"/"+Zawarudo.getFullYear()+"-"+Zawarudo.getHours()+":"+Zawarudo.getMinutes()+":"+Zawarudo.getSeconds();var reg=/([^a-zA-Z0-9_])/g;var validdefaultfilename=defaultfilename.replace(reg,"");encoderforAJAX.push(validdefaultfilename);document.cookie='filename=['+encoderforAJAX[0]+'] '+validdefaultfilename+';'+date.toGMTString()+';path=/'}else{var stringWhitespaceToClean=$(".namefilebuildsave").val();var userFilename=$.trim(stringWhitespaceToClean);encoderforAJAX.push(userFilename);document.cookie='filename=['+encoderforAJAX[0]+'] '+userFilename+';'+date.toGMTString()+';path=/'}
$(chosenOnes.children('td')).each(function(){encoderforAJAX.push($(this).text())});$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/php/savebuild.php',method:'POST',data:{build:encoderforAJAX},success:function(data){window.location.replace("http://alexandreblin.ovh/FireEmblemStrategicApp/php/userdownloadfile.php")}})})}
function fillParentList(nameChild){var Parents;$.get('http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/Tools/parentsList.txt',function(data){var lignes=data.split("+")
for(var i=0;i<lignes.length;i++){if(lignes[i].indexOf(nameChild)!==-1){Parents=lignes[i].split('-')}}
var removeMyName=Parents[0].split(":");Parents[0]=removeMyName[1];$.each((Parents),function(i){$("#myParent").append("<option value="+Parents[i]+">"+Parents[i]+"</option>")})},'text')}
$(".formulaireRecherche").on('change','#myParent',function(){$('.chooseAParent').hide();var parentName=$(this).val();var childName=$('.NomHerosBuilder').text();$.get('http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/Childrens/'+childName+'.txt',function(data){data=data.split("/");var childClass=data[1];getParentData(childName,parentName,childClass)},'text')});function getParentData(childName,parentName,childClass){$.get('http://alexandreblin.ovh/FireEmblemStrategicApp/HeroesData/'+parentName+'.txt',function(data){data=data.split("/");var parentClass=data[1];completeChildTalent(childName,parentName,childClass,parentClass)},'text')}
function completeChildTalent(childName,parentName,rawChildClass,rawParentClass){var FEAMale="Avatar(M),Basilio,Brady,Chrom,Donnel,Frederick,Gaius,Gangrel,Gerome,Gregor,Henry,Inigo,Kellam,Laurent,Libra,Lon'zu,Owain,Priam,Ricken,Stahl,Vaike,Virion,Walhart,Yarne,Yen'fay";var FEAFemale="Cynthia,Kjelle,Lucina,Nah,Noire,Severa";var childMale=!1;var childFemale=!1;if((FEAMale.indexOf(childName))>=0){childMale=!0}else if((FEAFemale.indexOf(childName))>=0){childFemale=!0}
var parentMale=!1;var parentFemale=!1;if((FEAMale.indexOf(parentName))>=0){parentMale=!0}else if((FEAFemale.indexOf(parentName))>=0){parentFemale=!0}
var listeClassesChild=rawChildClass.split('-');var listeClassesParent=rawParentClass.split('-');var parentClassClean=listCleaner(listeClassesParent,childMale,childFemale,parentMale,parentFemale);for(var i=0;i<listeClassesParent.length;i++){if(listeClassesChild.indexOf(parentClassClean[i])===-1){listeClassesChild.push(parentClassClean[i])}}
$("#TalentsList table").remove();$("#TalentsList").hide();TraitementData(listeClassesChild)}
function listCleaner(listParent,childMale,childFemale,parentMale,parentFemale){listParent.splice(-1,1);if(parentMale==!0){if(childFemale==!0){if(listParent.indexOf("Priest")>=0){listParent.splice($.inArray("Priest",listParent),1);listParent.push("Cleric");listParent.splice($.inArray("War Monk",listParent),1);listParent.push("War Cleric")}
if(listParent.indexOf("Barbarian")>=0){listParent.splice($.inArray("Barbarian",listParent),1);listParent.splice($.inArray("Berserker",listParent),1)}
if(listParent.indexOf("Fighter")>=0){listParent.splice($.inArray("Fighter",listParent),1)}
if(listParent.indexOf("Warrior")>=0){listParent.splice($.inArray("Warrior",listParent),1)}}}
if(parentFemale==!0){}
return listParent}})
