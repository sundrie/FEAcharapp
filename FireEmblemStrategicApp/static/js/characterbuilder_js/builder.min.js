$(function(){var heroesList;var allclassesList;$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/Data-FireEmblemAwakening/Tools/PersosList.xml',datatype:'xml',success:function(data){var characterList=$(data).children().children();$(characterList).each(function(i){$("#charList").append("<li><a href=#>"+$(this).attr("name")+"</a></li>")});heroesList=characterList}});$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/Data-FireEmblemAwakening/Tools/TalentsList.xml',datatype:'xml',success:function(data){var allclasses=$(data).children().children();allclassesList=allclasses}});$("#searchchar").on("click",function(){$('#searchchar').val('');$("#charList li").show()});$("#searchchar").on("keyup",function(){var saisieUser=$(this).val().toLowerCase();$("#charList li a").each(function(index){if($(this).text().toLowerCase().indexOf(saisieUser)===-1){$(this).parent().hide()}
else{$(this).parent().show()}})});var genitorName;var splittedParentsList;var childTestResult;function childOrNot(heroChosen){var genitor=heroChosen.children()[2]
genitorName=$(genitor).text();var parentsList=heroChosen.children()[1]
splittedParentsList=$(parentsList).text().split("-");if(genitorName===""){return!1}else{return!0}}
function searchMyData(theChosen){var classList=theChosen.children()[3];var splittedClassList=$(classList).text().split("-");var classes=[];$(allclassesList).each(function(i){if($.inArray($(this).attr("name"),splittedClassList)!==-1){classes.push($(this))}});return classes}
var theChosenOne;function searchThisName(findhim){var targetLocked;$(heroesList).each(function(i){if($(this).attr("name")===findhim){targetLocked=$(this)}});return targetLocked}
$('#charList').on("click","a",function(){$("#HeroBuild table tr td").empty();$("#HeroBuild table tr").find("tr").replaceWith('<td></td>');$("#HeroBuild table tr").removeClass().addClass("drop");dropTalents();var persoChoisi=$(this).text();$('#searchchar').val(persoChoisi);$(".HeroBuildCard").css("display","flex");$("#HeroImgBuilder").attr('src','http://alexandreblin.ovh/FireEmblemStrategicApp/static/img/character_portrait/'+persoChoisi+'_portrait.png');$(".NomHerosBuilder").html(persoChoisi);$("#TalentsList table").remove();$("#TalentsList").hide();$("#myParent").remove();$("#myParentLegacy").remove();$("#myGenitorLegacy").remove();$('.chooseAParent').hide();$('.chooseAParent p').remove();theChosenOne=searchThisName(persoChoisi);childTestResult=childOrNot(theChosenOne);if(childTestResult===!0){$('.formulaireRecherche .legacyArea').append("<select id='myGenitorLegacy' class='myParentclass myGenitorLegacyclass'><option value='default' selected>1er talent hérité</option></select>");legacy_of_Parent(genitorName,"myGenitorLegacy")
$('.formulaireRecherche .legacyArea').append("<select id='myParent' class='myParentclass'><option value='default' selected>Choisir parent</option></select>");$('.chooseAParent').show();$('.chooseAParent').append("<p class='messageChooseParent'>Veuillez choisir un parent dans la liste qui se trouve sous la liste des personnages pour continuer</p><p class='messageChooseParent'>Il faudra choisir aussi les talents qu'il recevra en héritage de ses parents</p>");fillSelectParent()}else{var theClassesList=searchMyData(theChosenOne);displayHeroData(theClassesList)}
$('.buildsave').remove();$('.OptionsMenu input').remove();$('.specialChara').remove();$('.OptionsMenu').append('<div class="specialChara"></div>');$('.OptionsMenu').append('<input type="text" name="filenamebyuser" class="namefilebuildsave" placeholder="nom du build">');$('.namefilebuildsave').on("keyup",function(){var UserTyping=$(this).val();var reg=/([/\\:*?"<>|])/g;var isASpecialCharacter=reg.test(UserTyping);if(isASpecialCharacter){$(this).val(UserTyping.replace(reg,''));$('.namefilebuildsave').css("border","3px solid rgb(255, 27, 0)");$('.specialChara').append("<p>Vous avez entré un caractère spécial qui ne peut être utilisé pour un nom de fichier");if($(".specialChara p").length>1){$('.specialChara p:gt(0)').remove()}else{setTimeout(function(){$('.namefilebuildsave').css("border","1px solid rgb(85, 57, 36)");$('.specialChara p').fadeOut('slow',function(){$('.specialChara p').remove()})},3000)}}});$('.OptionsMenu').append('<button class="buildsave"><i class="far fa-arrow-alt-circle-down"></i> Sauvegarder mon build</button>');saveMyBuild()});var legacyFirstTalent;var legacySecondTalent;function displayHeroData(classes){$(".goback").hide();$('#TalentsList').show();$('#TalentsList').append("<table class='drag'><tbody></tbody></table>");var talents;var talent1;var talent2;var imagelink;var descTalent
var useOnce=0;var useOnce2=0;$(classes).each(function(i){talents=classes[i].children();talent1=talents[0];talent2=talents[1];imagelink=$(talent1).children()[0];descTalent=$(talent1).children()[1];$("#TalentsList table tbody").append("<tr class="+classes[i].attr("name")+"><td><img src='"+$(imagelink).text()+"'>"+$(talent1).attr("name")+"</td><td>"+$(descTalent).text()+"</td></tr>");imagelink=$(talent2).children()[0];descTalent=$(talent2).children()[1];$("#TalentsList table tbody").append("<tr class="+classes[i].attr("name")+"><td><img src='"+$(imagelink).text()+"'>"+$(talent2).attr("name")+"</td><td>"+$(descTalent).text()+"</td></tr>");if(childTestResult===!0){if((legacyFirstTalent!==undefined)&&(useOnce===0)){var tmp=legacyFirstTalent.split('-');$("#TalentsList table tbody").append("<tr class="+tmp[0]+"><td><img src='http://alexandreblin.ovh/FireEmblemStrategicApp/static/img/talents_icons/"+$.trim(tmp[1])+".png'>"+tmp[1]+"</td><td>"+tmp[2]+"</td></tr>");$("#TalentsList ."+tmp[0]).addClass("drag");useOnce=1}
if((legacySecondTalent!==undefined)&&(useOnce2===0)){var tmp2=legacySecondTalent.split('-');$("#TalentsList table tbody").append("<tr class="+tmp2[0]+"><td><img src='http://alexandreblin.ovh/FireEmblemStrategicApp/static/img/talents_icons/"+$.trim(tmp2[1])+".png'>"+tmp2[1]+"</td><td>"+tmp2[2]+"</td></tr>");$("#TalentsList ."+tmp2[0]).addClass("drag");useOnce2=1}}
$("#TalentsList ."+classes[i].attr("name")).addClass("drag");$("#TalentsList table tbody .drag").draggable({containment:'.wrapper',helper:"clone",start:function(){$(this).animate({opacity:'0.5'},1000)},stop:function(){$(this).animate({opacity:'1'},1000)}})})}
function dropTalents(){$('.drop').droppable({accept:'.drag',drop:function(event,ui){var droppable=$(this);var draggable=ui.draggable;var droppablechild=$(droppable).children();if($(droppablechild[0]).is('td')){$(droppable).find('td').remove()
draggable.appendTo(droppable);$(draggable).draggable('disable');$(draggable).removeClass("drag");$($(draggable).children().first()).append("<i class='fas fa-times goback'></i>");$(".goback").show();$(".goback").on("click",function(){var trVoyager=$(this).parent().parent();var trDropOriginelle=$(this).parent().parent().parent();$(this).remove();$(".drag tbody").append(trVoyager[0]);$(trVoyager[0]).draggable('enable');$(draggable).addClass("drag");$(trDropOriginelle).append('<td></td>')})}}})}
function saveMyBuild(){$('.buildsave').on("click",function(){var alltr=$(".TalentsChoosenBuilder tbody tr");var chosenOnes=alltr.filter(':not(.drop)');var encoderforAJAX=[];var date=new Date();date.setTime(date.getTime()+(30*1000));var expires="; expires="+date.toGMTString();encoderforAJAX.push($('.NomHerosBuilder').text());if($(".namefilebuildsave").val()==""){var Zawarudo=new Date($.now());var defaultfilename=Zawarudo.getDate()+"/"+Zawarudo.getMonth()+"/"+Zawarudo.getFullYear()+"-"+Zawarudo.getHours()+":"+Zawarudo.getMinutes()+":"+Zawarudo.getSeconds();var reg=/([^a-zA-Z0-9_])/g;var validdefaultfilename=defaultfilename.replace(reg,"");encoderforAJAX.push(validdefaultfilename);document.cookie='filename=['+encoderforAJAX[0]+'] '+validdefaultfilename+';'+date.toGMTString()+';path=/'}else{var stringWhitespaceToClean=$(".namefilebuildsave").val();var userFilename=$.trim(stringWhitespaceToClean);encoderforAJAX.push(userFilename);document.cookie='filename=['+encoderforAJAX[0]+'] '+userFilename+';'+date.toGMTString()+';path=/'}
$(chosenOnes.children('td')).each(function(){encoderforAJAX.push($(this).text())});$.ajax({url:'http://alexandreblin.ovh/FireEmblemStrategicApp/php/savebuild.php',method:'POST',data:{data:encoderforAJAX},success:function(data){window.location.replace("http://alexandreblin.ovh/FireEmblemStrategicApp/php/userdownloadfile.php")}})})}
function fillSelectParent(){$.each((splittedParentsList),function(i){$("#myParent").append("<option value="+splittedParentsList[i]+">"+splittedParentsList[i]+"</option>")})}
$(".formulaireRecherche").on('change','#myParent',function(){$("#HeroBuild table tr").find("tr").replaceWith('<td></td>');$("#myParentLegacy").remove();$('.chooseAParent').hide();var parentName=$(this).val();$('.formulaireRecherche .legacyArea').append("<select id='myParentLegacy' class='myParentLegacyclass'><option value='default' selected>Choisir talent donné par "+parentName+"</option></select>");legacy_of_Parent(parentName,"myParentLegacy")});var parentTalents;function legacy_of_Parent(parentName,selectId){var dataParent=searchThisName(parentName);parentTalents=searchMyData(dataParent);var talent1;var talent2;var talentdesc;var classNameOfTalent;$.each((parentTalents),function(i){talent1=$(parentTalents)[i].children()[0];talent2=$(parentTalents)[i].children()[1];talentdesc=$(talent1).children()[1];classNameOfTalent=$(parentTalents)[i].attr("name");$("#"+selectId).append("<option value="+classNameOfTalent+">"+$(talent1).attr("name")+" - "+$(talentdesc).text()+"</option>");talentdesc=$(talent2).children()[1];$("#"+selectId).append("<option value="+classNameOfTalent+">"+$(talent2).attr("name")+" - "+$(talentdesc).text()+"</option>")})}
$(".formulaireRecherche").on('change','#myGenitorLegacy',function(){$("#HeroBuild table tr").find("tr").replaceWith('<td></td>');getBothSelectValue()})
$(".formulaireRecherche").on('change','#myParentLegacy',function(){$("#HeroBuild table tr").find("tr").replaceWith('<td></td>');getBothSelectValue()})
function getBothSelectValue(){var tmp=$("#myGenitorLegacy option:selected").text().split('-');var genitorTalentGift=tmp[0];var tmp=$("#myParentLegacy option:selected").text().split('-');var secondParentTalentGift=tmp[0];var genitorData=searchThisName(genitorName)
var secondParentData=searchThisName($("#myParent").val())
if(($("#myGenitorLegacy option:selected").text()!="")&&!($("#myGenitorLegacy").val()==="default")&&($("#myParentLegacy option:selected").text()!="")&&!($("#myParentLegacy").val()==="default")){completeChildTalent(genitorTalentGift,$("#myGenitorLegacy").val(),genitorData,secondParentTalentGift,$("#myParentLegacy").val(),secondParentData)}}
function completeChildTalent(genitorTalentGift,genitorTalentOrigin,genitorData,secondParentTalentGift,secondParentTalentOrigin,secondParentData){var childTalentsTree=searchMyData(theChosenOne);var secondParentTalentsTree=searchMyData(secondParentData);secondParentTalentsTree.pop();var alteredParentTalentsTree=[];var replacementClass;if($(secondParentData.children()[0]).text()==="Homme"){if($(theChosenOne.children()[0]).text()==="Femme"){$.each((secondParentTalentsTree),function(i){if(secondParentTalentsTree[i].attr("name")==="Priest"){alteredParentTalentsTree.push(secondParentTalentsTree[i].attr("name","Cleric"))}
else if(secondParentTalentsTree[i].attr("name")==="War_Monk"){alteredParentTalentsTree.push(secondParentTalentsTree[i].attr("name","War_Cleric"))}
else if(secondParentTalentsTree[i].attr("name")==="Barbarian"){}
else if(secondParentTalentsTree[i].attr("name")==="Berserker"){}
else if(secondParentTalentsTree[i].attr("name")==="Fighter"){}
else if(secondParentTalentsTree[i].attr("name")==="Villager"){}
else if(secondParentTalentsTree[i].attr("name")==="Warrior"){}
else if(secondParentTalentsTree[i].attr("name")==="Lord"){}
else if(secondParentTalentsTree[i].attr("name")==="Great_Lord"){}
else if(secondParentTalentsTree[i].attr("name")==="Tactician"){}
else if(secondParentTalentsTree[i].attr("name")==="Grandmaster"){}
else{alteredParentTalentsTree.push(secondParentTalentsTree[i])}})}}
var compareA=[];if($(theChosenOne.children()[0]).text()==="Femme"){$.each(alteredParentTalentsTree,function(i){compareA.push($(alteredParentTalentsTree)[i].attr("name"))})}else{$.each(secondParentTalentsTree,function(i){compareA.push($(secondParentTalentsTree)[i].attr("name"))})}
var compareB=[];$.each(childTalentsTree,function(i){compareB.push($(childTalentsTree)[i].attr("name"))});var mergedTalentsTreeList=compareB;$.each(compareA,function(i){if($.inArray(compareA[i],compareB)===-1){mergedTalentsTreeList.push(compareA[i])}})
legacyFirstTalent=undefined;legacySecondTalent=undefined;$.each(mergedTalentsTreeList,function(i){if($.inArray(genitorTalentOrigin,mergedTalentsTreeList)===-1){legacyFirstTalent=genitorTalentOrigin+" - "+$("#myGenitorLegacy :selected").text()}
else if($.inArray(secondParentTalentOrigin,mergedTalentsTreeList)===-1){legacySecondTalent=secondParentTalentOrigin+" - "+$("#myParentLegacy :selected").text()
return!1}});var finalList=[];var sortMyList=!1;$(allclassesList).each(function(i){if($.inArray($(this).attr("name"),mergedTalentsTreeList)!==-1){finalList.push($(this));if(($(this).attr("name")==="Cleric")||($(this).attr("name")==="Cleric")){sortMyList=!0}}})
if(sortMyList===!0){var j;for(var i=0;i<finalList.length;i++){j=i+1;if(j===finalList.length){break}
if(finalList[j].attr("name")===finalList[i].attr("name")){finalList.splice(j,1)}}}
$("#TalentsList table").remove();$("#TalentsList").hide();displayHeroData(finalList)}})