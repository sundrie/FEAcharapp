$(function(){$.ajax({url:"http://localhost/FEAcharapp/HeroesData/",success:function(e){$(e).find("a:contains(.txt)").each(function(){var e=this.href.replace(window.location.host,"").replace("http:///","").split(/[\/+.]/g);$("#charList").append("<li><a href=#>"+e[2]+"</a></li>")})}});var e=[];function t(e){$(".goback").hide(),$.ajax({url:"http://localhost/FEAcharapp/pages/class_talents_list.html",type:"GET",success:function(t){var a,i=t;$("#TalentsList").append(i),$("#TalentsList").show(),$("#TalentsList").append("<table class='tableskill2 drag'><tbody></tbody></table>"),$("#TalentsList").append("<table class='tableskill1 drag'><tbody></tbody></table>"),$(".TalentsListclass").css("border","2px solid rgb(110, 108, 93)"),$(".TalentsListclass").css("overflow-y","scroll"),$("#TalentsList table tr").each(function(){var e=$(this).children("td").eq(3),t=$(this).children("td").eq(4);$("<tr class='"+$(this).attr("class")+"'><td>"+e.html()+"</td><td>"+t.html()+"</td></tr>").appendTo(".tableskill2 tbody"),e.remove(),t.remove();var a=$(this).children("td").eq(1),i=$(this).children("td").eq(2);$("<tr class='"+$(this).attr("class")+"'><td>"+a.html()+"</td><td>"+i.html()+"</td></tr>").appendTo(".tableskill1 tbody"),a.remove(),i.remove()}),$("#TalentsList table tr").hide();for(var s=0;s<e.length;s++)a=e[s].split(" ").join(""),$("tableau:contains('."+a+"')")&&($("#TalentsList ."+a).show(),$("#TalentsList ."+a).addClass("drag"),$("#TalentsList ."+a).draggable({containment:".wrapper",helper:"clone",start:function(){$(this).parent().index(),$(this).index();$(this).animate({opacity:"0.5"},1e3)},stop:function(){$(this).animate({opacity:"1"},1e3)}}));$("#TalentsList table").first().remove()}})}$.ajax({url:"http://localhost/FEAcharapp/HeroesData/Childrens",success:function(t){$(t).find("a:contains(.txt)").each(function(){var t=this.href.replace(window.location.host,"").replace("http:///","").split(/[\/+.]/g);$("#charList").append("<li><a href=#>"+t[2]+"</a></li>"),e.push(t[2])})}}),$("#searchchar").on("click",function(){$("#searchchar").val(""),$("#charList li").show()}),$("#searchchar").on("keyup",function(){var e=$(this).val().toLowerCase();$("#charList li a").each(function(t){-1===$(this).text().toLowerCase().indexOf(e)?$(this).parent().hide():$(this).parent().show()})}),$("#charList").on("click","a",function(){$("#HeroBuild table tr td").empty(),$("#HeroBuild table tr").find("tr").replaceWith("<td></td>"),$("#HeroBuild table tr").removeClass().addClass("drop"),$(".drop").droppable({accept:".drag",drop:function(e,t){var a=$(this),i=t.draggable,s=$(a).children();if($(s[0]).is("td")){$(i).parent().index(),$(i).index();var r=$(i).closest("table").attr("class").split(" ")[0];$(a).find("td").remove(),i.appendTo(a),$(i).draggable("disable"),$(i).removeClass("drag"),$(i).append("<button class='goback'>X</button>"),$(".goback").show(),$(".goback").on("click",function(){var e=$(this).parent(),t=$(this).parent().parent();$(this).remove(),$("."+r+" tbody").after(e[0]),$(e[0]).draggable("enable"),$(i).addClass("drag"),$(t).append("<td></td>")})}}});var a,i,s=$(this).text();if($("#searchchar").val(s),$(".HeroBuildCard ").css("display","flex"),$("#HeroImgBuilder").attr("src","http://localhost/FEAcharapp/static/img/character_portrait/"+s+"_portrait.png"),$(".NomHerosBuilder").html(s),$("#TalentsList table").remove(),$("#TalentsList").hide(),$("#myParent").remove(),$(".chooseAParent").hide(),$(".chooseAParent p").remove(),-1!==jQuery.inArray(s,e)){var r=s;$(".formulaireRecherche").append("<select id='myParent' class='myParentclass'><option value='default' selected>Choisir parent</option></select>"),$(".chooseAParent").show(),$(".chooseAParent").append("<p class='messageChooseParent'>Veuillez choisir un parent dans la liste qui se trouve sous la liste des personnages pour continuer</p>"),a=r,$.get("http://localhost/FEAcharapp/HeroesData/Tools/parentsList.txt",function(e){for(var t=e.split("+"),s=0;s<t.length;s++)-1!==t[s].indexOf(a)&&(i=t[s].split("-"));var r=i[0].split(":");i[0]=r[1],$.each(i,function(e){$("#myParent").append("<option value="+i[e]+">"+i[e]+"</option>")})},"text")}else $.get("http://localhost/FEAcharapp/HeroesData/"+s+".txt",function(e){t(e.split("/")[1].split("-"))},"text");$(".buildsave").remove(),$(".OptionsMenu input").remove(),$(".OptionsMenu").append('<input type="text" name="filenamebyuser" class="namefilebuildsave" placeholder="nom du build">'),$(".OptionsMenu").append('<button class="buildsave">Sauvegarder mon build</button>'),$(".buildsave").on("click",function(){var e=$(".TalentsChoosenBuilder tbody tr"),t=e.filter(":not(.drop)"),a=[],i=new Date;if(i.setTime(i.getTime()+3e4),i.toGMTString(),a.push($(".NomHerosBuilder").text()),""==$(".namefilebuildsave").val()){var s=new Date($.now()),r=s.getDate()+"/"+s.getMonth()+"/"+s.getFullYear()+"-"+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds(),n=r.replace(/([^a-zA-Z0-9_])/g,"");a.push(n),document.cookie="filename=["+a[0]+"] "+n+";"+i.toGMTString()+";path=/"}else a.push($(".namefilebuildsave").val()),document.cookie="filename=["+a[0]+"] "+$(".namefilebuildsave").val()+";"+i.toGMTString()+";path=/";$(t.children("td")).each(function(){a.push($(this).text())}),$.ajax({url:"http://localhost/FEAcharapp/php/savebuild.php",method:"POST",data:{build:a},success:function(e){window.location.replace("http://localhost/FEAcharapp/php/userdownloadfile.php")}})})}),$(".formulaireRecherche").on("change","#myParent",function(){$(".chooseAParent").hide();var e=$(this).val(),a=$(".NomHerosBuilder").text();$.get("http://localhost/FEAcharapp/HeroesData/Childrens/"+a+".txt",function(i){var s,r,n,l=(i=i.split("/"))[1];s=a,r=e,n=l,$.get("http://localhost/FEAcharapp/HeroesData/"+r+".txt",function(e){var a=(e=e.split("/"))[1];!function(e,a,i,s){var r="Avatar(M),Basilio,Brady,Chrom,Donnel,Frederick,Gaius,Gangrel,Gerome,Gregor,Henry,Inigo,Kellam,Laurent,Libra,Lon'zu,Owain,Priam,Ricken,Stahl,Vaike,Virion,Walhart,Yarne,Yen'fay",n="Cynthia,Kjelle,Lucina,Nah,Noire,Severa",l=!1;r.indexOf(e)>=0||n.indexOf(e)>=0&&(l=!0);var o,c,p,h=!1;r.indexOf(a)>=0?h=!0:n.indexOf(a);for(var d=i.split("-"),u=s.split("-"),f=(c=l,p=h,(o=u).splice(-1,1),1==p&&1==c&&(o.indexOf("Priest")>=0&&(o.splice($.inArray("Priest",o),1),o.push("Cleric"),o.splice($.inArray("War Monk",o),1),o.push("War Cleric")),o.indexOf("Barbarian")>=0&&(o.splice($.inArray("Barbarian",o),1),o.splice($.inArray("Berserker",o),1)),o.indexOf("Fighter")>=0&&o.splice($.inArray("Fighter",o),1),o.indexOf("Warrior")>=0&&o.splice($.inArray("Warrior",o),1)),o),v=0;v<u.length;v++)-1===d.indexOf(f[v])&&d.push(f[v]);$("#TalentsList table").remove(),$("#TalentsList").hide(),t(d)}(s,r,n,a)},"text")},"text")})});
